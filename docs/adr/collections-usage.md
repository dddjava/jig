# コレクションの扱い

1. **ファーストクラスコレクション** を採用し、コレクションクラスはドメインオブジェクト内の責務を表現するクラスとして使用します。
2. APIのインタフェースでは柔軟性を重視し、必要に応じて `Collection` やその具体的なサブタイプ（`List` や `Set`）、あるいは `Stream` を使用することを許容します。

### ファーストクラスコレクション

- `List` や `Set` などCollectionsFrameworkの直接使用を避け、その責務を表現するファーストクラスコレクションを設計します。
- ファーストクラスコレクション内では、適切なコレクション操作を実装し、ロジックの一貫性と安全性を高めます。
- ファーストクラスコレクションは実質的イミュータブルとして扱います。イミュータブルを保証するためのコンストラクタや取得での防御的コピーは行いません。
- コレクション要素に対する破壊的操作はファーストクラスコレクション内でのみ行い、該当する操作を行う場合は新たなコレクションインスタンスを生成します。
- ファーストクラスコレクションのコンポーネントやコレクションの要素に `null` は使用しません。
- ファーストクラスコレクションが一つのみの場合、名称は要素の複数形を許容しますが、可能限りコレクションの目的に応じた名称を使用します。
  - これにより同じコンポーネントを持つ複数のファーストクラスコレクションが存在することになります。

### Collections Frameworkインタフェースの使用基準

ファーストクラスコレクションのコンポーネントやAPIインタフェースにて使用するCollectionsFrameworkを以下のようにします。

- 順序が必要な場合は `List` を使用します。
  - 順序に関するドキュメントを記述します。
  - ファーストクラスコレクションのコンストラクタではソートしない。ソートはファクトリメソッドで行います。
- 重複を防ぐ場合で `equals` / `hashCode` が適切な場合は `Set` を使用します。
- 明確な理由がない場合は `Collection` を使用し、特定の型（例: `List`, `Set`）を避けます。

### 実装例

```java
import java.util.ArrayList;

record Items(List<Item> items) {

  static Items from(Collection<Item> items) {
    return new Items(items.stream().sorted().toList());
  }

  public Items addItem(Item item) {
    var list = new ArrayList<>(items);
    list.add(item);
    return new Items(list);
  }
}
```
